<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<f:view locale="#{localeBean.locale}">
<h:head>
    <title>#{msg['resumenTitulo']}</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <style>
        body {
            background: linear-gradient(135deg, #e1f5fe, #b3e5fc);
            font-family: 'Segoe UI', Roboto, sans-serif;
        }
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        h2 {
            color: #01579b;
            font-weight: 700;
        }
        th, td {
            text-align: center;
            vertical-align: middle;
        }
        .btn-danger {
            font-weight: bold;
        }
        
        .btn-danger {
    background-color: #e53935;
    border: none;
}
.btn-danger:hover {
    background-color: #c62828;
}
    </style>
</h:head>

<h:body>
    <div class="container py-5">
        <h:form id="formResumen">
            <div class="card shadow-sm">
                <div class="card-body p-4">

                    <h2 class="text-center mb-4">#{msg['resumenTitulo']}</h2>

                    <!-- âœ… Mensaje JSF -->
                    <h:messages id="msg"
                                globalOnly="true"
                                layout="table"
                                styleClass="alert alert-success text-center"
                                style="display:none; font-weight:bold;" />

                    <!-- âœ… Script para mostrar/ocultar mensaje -->
                    <h:outputScript target="body">
                        function mostrarMensaje() {
                            const msgBox = document.getElementById('formResumen:msg');
                            if (msgBox &amp;&amp; msgBox.innerText.trim() !== "") {
                                msgBox.style.display = 'block';
                                setTimeout(function() {
                                    msgBox.style.display = 'none';
                                }, 2000);
                            }
                        }
                    </h:outputScript>

                    <!-- âœ… Tabla del resumen -->
                    <h:dataTable value="#{deporteBean.resumen}" var="act"
                                 styleClass="table table-striped table-hover text-center align-middle"
                                 rendered="#{not empty deporteBean.resumen}">
                        
                        <!-- Deporte -->
                        <h:column>
                            <f:facet name="header">#{msg['resumenDeporte']}</f:facet>
                            #{msg[act.deporte]}
                        </h:column>

                        <!-- Nombre -->
                        <h:column>
                            <f:facet name="header">#{msg['detalleNombre']}</f:facet>
                            #{act.nombre}
                        </h:column>

                        <!-- Distancia -->
                        <h:column>
                            <f:facet name="header">#{msg['detalleDist']}</f:facet>
                            #{act.distancia} km
                        </h:column>

                        <!-- DuraciÃ³n -->
                        <h:column>
                            <f:facet name="header">#{msg['detalleDur']}</f:facet>
                            #{act.duracion} min
                        </h:column>

                        <!-- CalorÃ­as -->
                        <h:column>
                            <f:facet name="header">#{msg['detalleCal']}</f:facet>
                            #{act.calorias} kcal
                        </h:column>

                        <!-- ðŸ—‘ï¸ Eliminar -->
                        <h:column>
                            <f:facet name="header">#{msg['resumenEliminar']}</f:facet>
                            <h:commandButton value="âœ–"
                                             action="#{deporteBean.eliminarActividad(act)}"
                                             styleClass="btn btn-sm btn-danger">
                                <f:ajax execute="@this" render="@form" onevent="mostrarMensaje" />
                            </h:commandButton>
                        </h:column>
                    </h:dataTable>

                    <!-- Si no hay actividades -->
                    <h:panelGroup rendered="#{empty deporteBean.resumen}">
                        <p class="text-center text-muted">#{msg['resumenVacio']}</p>
                    </h:panelGroup>

                    <!-- Totales -->
                    <h:panelGroup rendered="#{not empty deporteBean.resumen}">
                        <hr/>
                        <div class="row text-center mt-4">
                            <div class="col">
                                <h5>#{msg['resumenTotalDist']}</h5>
                                <p>#{deporteBean.totalDistancia} km</p>
                            </div>
                            <div class="col">
                                <h5>#{msg['resumenTotalDur']}</h5>
                                <p>#{deporteBean.totalDuracion} min</p>
                            </div>
                            <div class="col">
                                <h5>#{msg['resumenTotalCal']}</h5>
                                <p>#{deporteBean.totalCalorias} kcal</p>
                            </div>
                        </div>
                    </h:panelGroup>

                    <!-- Botones -->
                    <div class="d-flex justify-content-between mt-5">
                        
                        <h:commandButton value="#{msg['logout']}" 
                         action="#{logoutBean.logout}" 
                         styleClass="btn btn-danger btn-sm" />
                        <h:commandButton value="#{msg['volverDeportes']}"
                                         action="deportes.xhtml?faces-redirect=true"
                                         styleClass="btn btn-secondary" />
                        <h:commandButton value="#{msg['generarPDF']}"
                                         action="#{pdfBean.generarResumenPDF}"
                                         styleClass="btn btn-info"
                                         disabled="#{empty deporteBean.resumen}" />
                        <h:commandButton value="#{msg['irFacturacion']}"
                                         action="facturacion"
                                         styleClass="btn btn-primary" />
                    </div>
                </div>
            </div>
        </h:form>
    </div>
</h:body>
</f:view>
</html>